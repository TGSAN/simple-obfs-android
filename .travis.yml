language: android

jdk:
  - oraclejdk8

env:
    global:
        - NDK_VERSION=r12b
        - NDK_CCACHE=ccache
        - ANDROID_NDK_HOME=$HOME/.android/android-ndk-${NDK_VERSION}
        - SBTPATH=$HOME/.sbt
        - PATH=${ANDROID_NDK_HOME}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${PATH}

scala:
    - 2.11.8

before_cache:
    - find $HOME/.sbt -name "*.lock" | xargs rm
    - find $HOME/.ivy2 -name "*.lock" | xargs rm

cache:
    directories:
        - $HOME/.ivy2
        - $HOME/.sbt

android:
    components:
        - tools
        - build-tools-25.0.2
        - extra-android-m2repository

install:
    - >
      if [ ! -d "$ANDROID_NDK_HOME" ]; then
          mkdir -p $ANDROID_NDK_HOME;
          pushd $HOME/.android;
          export ARCH=`uname -m`;
          wget -q http://dl.google.com/android/repository/android-ndk-${NDK_VERSION}-linux-${ARCH}.zip;
          unzip -q android-ndk-${NDK_VERSION}-linux-${ARCH}.zip;
          popd;
      fi
    - >
      if [ ! -f "$SBTPATH/sbt" ]; then
          pushd $SBTPATH;
          wget -q https://raw.githubusercontent.com/paulp/sbt-extras/master/sbt;
          chmod a+x sbt;
          popd;
      fi

script:
    - $SBTPATH/sbt android:package

before_deploy:
      - git config --local user.name "xianren78"
      - git config --local user.email "qgtxqj@gmail.com"
      - git tag "$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)"
      - find $HOME/ -name "obfs-local-debug.apk" -exec mv {} $HOME/ \;
deploy:
  provider: releases
  api_key:
    secure: "bwMT8eM3VFzT9428hF11FInMcPE74nE/fvA/ltVz5szLJD4+cuCndPukpX1xDaH0Q1a1DFpnDQ20e/dMTwY4VjE7tJ9EMiba753L3YqfifnXm8lNk+UpQYyjvTDHvPBFsTdU0fsxwEt4d+yEXbXgtC2jhEv8T5Wz6zhGbKXY2Km6JfVsFcFumvYYt+Fkr7VELUPQ/5UBbN+HXXm9fAlWod25AH9a2OgztxRB4UwY+b92W/U7Uhfw/rQn3FbTJS82791jLsVSNxcYiOcmj5SKABCNHdGVSrBWuTf7AEgJ+or7Tu3ymSE0+cm5f3qN/Ii0epq5JIwh2i7DeBjAuMda5Ygddg7OtZRvTK+XIYBuZikHyZbDc1VfdV7rQA6LsEJ/ewelT6PMPVVubDmHN9HvCeuw/JHQKg7PDXEmBL3il26Wq7Bha4WP4nAHWJOkf7W/gWKApOJ33mLba4eirHlW1z74f1HQw4sztesl2bux+Oi3lEbK3HU83u4g0dsAUK8jtFXVGBtdIBHTIrxiiQu0gJInP+F7d7uzhHwQXxyAz//6toWL1w8vt7QADYdtvdyxJ5134RunZ9C0cuvO9w99SrSzawjvEsEyw8TJ/1BPmDdYVDhkRB/TM1dz+bOQglzT+mxovzwiWuX8QcpU6JA61xNjbRIOaRcy1Rn3XoQyTxo="
  file: "$HOME/obfs-local-debug.apk"
  skip_cleanup: true
